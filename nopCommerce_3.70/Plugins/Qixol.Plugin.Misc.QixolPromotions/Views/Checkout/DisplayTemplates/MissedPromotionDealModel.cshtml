@model MissedPromotionDealModel

@using Qixol.Plugin.Misc.Promo.Models.Checkout;
@using global::Nop.Web.Models.Catalog;
@using global::Nop.Core.Domain.Orders;
@using global::Nop.Web.Models.Media;

@{
    Layout = null;
}
<style>
    .product.missed-promotion .add-to-cart-button {
        min-width: 160px;
        border: none;
        background-color: #4ab2f1;
        padding: 10px 20px;
        font-size: 16px;
        color: #fff;
        text-transform: uppercase;
    }
</style>
<tr>
    <td class="product-picture">
        @{
            var matchedCartItemModel = Model.MatchedCartItemModels.FirstOrDefault();
            if (matchedCartItemModel != null)
            {
                <div><a href="@Url.RouteUrl("Product", new { SeName = matchedCartItemModel.ProductSeName })"><img alt="@matchedCartItemModel.Picture.AlternateText" src="@matchedCartItemModel.Picture.ImageUrl" title="@matchedCartItemModel.Picture.Title" /></a></div>
            }
        }
    </td>
    <td class="product missed-promotion">
        <div style="display: inline-block; width: 100%;">
            @if (matchedCartItemModel != null)
            {
                <a href="@Url.RouteUrl("Product", new { SeName = matchedCartItemModel.ProductSeName })" class="product-name">@matchedCartItemModel.ProductName</a>
                if (!String.IsNullOrEmpty(matchedCartItemModel.AttributeInfo))
                {
                    <div class="attributes">
                        @Html.Raw(matchedCartItemModel.AttributeInfo)
                    </div>
                }
            }
            @if (!string.IsNullOrEmpty(@Model.PromotionName))
            {
                <div class="promotion-item">@Model.PromotionName</div>
            }
            else
            {
                <div class="promotion-item">Deal</div>
            }
            @if (Model.UnmatchedProductDetailsModels != null && Model.UnmatchedProductDetailsModels.Count > 0)
            {
                <table>
                    <thead>
                        <tr>
                            <th class="product-picture">
                                @T("ShoppingCart.Image")
                            </th>
                            <th class="product">
                                @T("Plugins.Misc.QixolPromo.Product(s)")
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var missedPromoProductDetailsModel in Model.UnmatchedProductDetailsModels)
                        {
                            PictureModel pictureModel = null;
                            if (missedPromoProductDetailsModel.ProductDetailsModel.PictureModels != null && missedPromoProductDetailsModel.ProductDetailsModel.PictureModels.Count > 0)
                            {
                                pictureModel = missedPromoProductDetailsModel.ProductDetailsModel.PictureModels.First();
                            }
                            <tr>
                                <td>
                                    @if (pictureModel != null)
                                    {
                                        <img alt="@pictureModel.AlternateText" src="@pictureModel.ImageUrl" title="@pictureModel.Title" />
                                    }
                                </td>
                                <td>
                                    @missedPromoProductDetailsModel.ProductDetailsModel.Name
                                    @{
                                        var addToCartModel = missedPromoProductDetailsModel.ProductDetailsModel.AddToCart;
                                        if (addToCartModel != null)
                                        {
                                            var addToCartFormId = "addToCartForm_" + addToCartModel.UpdatedShoppingCartItemId;
                                            <form id="@addToCartFormId" method="post">
                                                <div class="add-to-cart-panel" style="float: right;">
                                                    @foreach (KeyValuePair<string, string> kvp in missedPromoProductDetailsModel.Attributes)
                                                    {
                                                        <input id="product_attribute_@(kvp.Key)" name="product_attribute_@(kvp.Key)" type="hidden" value="@(kvp.Value)">
                                                    }
                                                    <input id="addtocart_@(addToCartModel.ProductId).EnteredQuantity" name="addtocart_@(addToCartModel.ProductId).EnteredQuantity" type="hidden" value="1" />
                                                    <script type="text/javascript">
                                                        function addToCart_@(addToCartModel.UpdatedShoppingCartItemId)() {
                                                            var addUrl = '@Url.RouteUrl("AddProductToCart-Details", new { productId = addToCartModel.ProductId, shoppingCartTypeId = (int) ShoppingCartType.ShoppingCart })';
                                                            var formSelector = '#@(addToCartFormId)';
                                                            promoAjaxCart.addproducttocart_missedPromotions(addUrl, formSelector);
                                                        }
                                                    </script>

                                                    @{
                                                        var addToCartText = "";
                                                        addToCartText = T("ShoppingCart.AddToCart").Text;
                                                    }
                                                    <input type="button" id="add-to-cart-button-@addToCartModel.UpdatedShoppingCartItemId" class="button-1 add-to-cart-button" value="@addToCartText" data-productid="@addToCartModel.ProductId" onclick="addToCart_@(addToCartModel.UpdatedShoppingCartItemId)();" />
                                                </div>
                                            </form>
                                                        }
                                    }
                                </td>
                            </tr>
                                                        }
                    </tbody>
                </table>
            }
        </div>
    </td>
</tr>
